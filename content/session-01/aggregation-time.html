<div class="content-section">
    <div class="mb-8">
        <div class="flex items-center mb-4">
            <div class="w-3 h-8 bg-green-500 rounded-full mr-4"></div>
            <h2 class="text-3xl font-bold text-gray-900">Part 3: Aggregation & Time-Based Analysis</h2>
        </div>
        <p class="text-lg text-gray-600 mb-6 leading-relaxed">KQL includes a rich library of functions for manipulating data. Here, we'll cover common string and datetime functions. We will also visualize time-series data by grouping events into time buckets, a crucial technique for trend analysis.</p>
    </div>
    
    <div>
        <h3 class="text-xl font-semibold mb-6 mt-8 text-gray-800">1. Summarizing with <code class="text-lg">bin()</code> for Time Charts</h3>
        <p class="mb-6">The <code class="bg-blue-50 text-blue-700 px-2 py-1 rounded-md font-mono text-sm">bin()</code> function groups data into fixed time intervals (e.g., hours, days). When combined with <code class="bg-blue-50 text-blue-700 px-2 py-1 rounded-md font-mono text-sm">summarize</code> and <code class="bg-blue-50 text-blue-700 px-2 py-1 rounded-md font-mono text-sm">render timechart</code>, it's a powerful way to visualize trends.</p>
        <div class="code-block relative rounded-lg p-4 font-mono text-sm my-6">
            <div class="flex space-x-2 absolute top-2 right-2">
                <button class="copy-btn bg-blue-100 text-blue-800 px-2 py-1 rounded-md text-xs hover:bg-blue-200 transition-colors">Copy</button>
            </div>
            <pre><code><span class="kql-table">AuthenticationEvents</span>
<span class="kql-pipe">|</span> <span class="kql-keyword">extend</span> timestamp = <span class="kql-function">todatetime</span>(timestamp)
<span class="kql-pipe">|</span> <span class="kql-keyword">summarize</span> <span class="kql-function">count()</span> <span class="kql-keyword">by</span> result, <span class="kql-function">bin</span>(timestamp, 1h)
<span class="kql-pipe">|</span> <span class="kql-function">render</span> timechart</code></pre>
        </div>
        <div class="mt-6 bg-white p-6 rounded-lg shadow-md">
            <p class="text-center font-medium mb-4 text-gray-800">Example Visualization: Authentication Activity Per Hour by Result</p>
            <div class="flex justify-center">
                <img src="images/samples/authentication-events-timechart-sample.jpeg" 
                     alt="Time chart showing authentication events per hour with separate lines for Success and Failed results" 
                     class="max-w-full h-auto rounded-lg shadow-sm border border-gray-200">
            </div>
            <p class="text-sm text-gray-600 mt-3 text-center italic">
                Screenshot from Azure Data Explorer showing the timechart visualization of authentication events
            </p>
        </div>
    </div>

    <div>
        <h3 class="text-xl font-semibold mb-6 mt-8 text-gray-800">2. Advanced Aggregations</h3>
        <p class="mb-6">The <code class="bg-blue-50 text-blue-700 px-2 py-1 rounded-md font-mono text-sm">arg_max()</code> and <code class="bg-blue-50 text-blue-700 px-2 py-1 rounded-md font-mono text-sm">arg_min()</code> functions are powerful ways to find the most recent or earliest event for each item in a group. They return the entire row corresponding to the minimum or maximum value.</p>
        <div class="code-block relative rounded-lg p-4 font-mono text-sm my-6">
            <div class="flex space-x-2 absolute top-2 right-2">
                <button class="copy-btn bg-blue-100 text-blue-800 px-2 py-1 rounded-md text-xs hover:bg-blue-200 transition-colors">Copy</button>
            </div>
            <pre><code><span class="kql-comment">// Find the earliest and latest authentication event for each user</span>
<span class="kql-table">AuthenticationEvents</span>
<span class="kql-pipe">|</span> <span class="kql-keyword">summarize</span> 
    earliest_event_timestamp <span class="kql-pipe">=</span> <span class="kql-function">arg_min</span>(timestamp, timestamp), 
    latest_event_timestamp <span class="kql-pipe">=</span> <span class="kql-function">arg_max</span>(timestamp, timestamp) 
    <span class="kql-keyword">by</span> username
<span class="kql-pipe">|</span> <span class="kql-function">take</span> 10</code></pre>
        </div>
    </div>

    <div>
        <h3 class="text-xl font-semibold mb-6 mt-8 text-gray-800">3. Aggregating by IP Address</h3>
        <p class="mb-6">You can summarize by any column, including IP addresses, to find patterns in network activity. This query finds the top 10 IP addresses with the most authentication attempts.
        </p>
        <div class="code-block relative rounded-lg p-4 font-mono text-sm my-6">
            <div class="flex space-x-2 absolute top-2 right-2">
                <button class="copy-btn bg-blue-100 text-blue-800 px-2 py-1 rounded-md text-xs hover:bg-blue-200 transition-colors">Copy</button>
            </div>
            <pre><code><span class="kql-table">AuthenticationEvents</span>
<span class="kql-pipe">|</span> <span class="kql-keyword">summarize</span> Attempts <span class="kql-pipe">=</span> <span class="kql-function">count()</span> <span class="kql-keyword">by</span> src_ip
<span class="kql-pipe">|</span> <span class="kql-keyword">top</span> 10 <span class="kql-keyword">by</span> Attempts <span class="kql-keyword">desc</span></code></pre>
        </div>
    </div>
</div>