<div class="content-section">
    <div class="mb-8">
        <div class="flex items-center mb-4">
            <div class="w-3 h-8 bg-indigo-500 rounded-full mr-4"></div>
            <h2 class="text-3xl font-bold text-gray-900">Part 6: Challenge Queries</h2>
        </div>
        <p class="text-lg text-gray-600 mb-6 leading-relaxed">Now it's time to put everything together. These challenges require you to combine filtering, aggregation, and joining to find key insights in the data. Try to solve them yourself before revealing the solution.</p>
    </div>

    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 p-6 rounded-xl shadow-sm">
        <p class="font-semibold text-gray-800 text-lg">Challenge 1: Find the top 3 users with the most failed logins in the last 7 days.</p>
    </div>
    <button id="solution-btn-1" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors duration-200 font-medium shadow-sm mt-4 mb-2">Show Solution</button>
    <div id="solution-div-1" class="hidden mt-4">
        <div class="code-block relative rounded-lg p-4 font-mono text-sm my-6 shadow-sm">
            <div class="flex space-x-2 absolute top-2 right-2">
                <button class="copy-btn bg-blue-100 text-blue-800 px-2 py-1 rounded-md text-xs hover:bg-blue-200 transition-colors duration-200">Copy</button>
            </div>
            <pre><code><span class="kql-table">AuthenticationEvents</span>
<span class="kql-pipe">|</span> <span class="kql-keyword">where</span> timestamp <span class="kql-pipe">&gt;=</span> <span class="kql-function">ago</span>(7d) <span class="kql-keyword">and</span> result <span class="kql-pipe">==</span> <span class="kql-string">"Failed Login"</span>
<span class="kql-pipe">|</span> <span class="kql-keyword">summarize</span> <span class="kql-function">count()</span> <span class="kql-keyword">by</span> username
<span class="kql-pipe">|</span> <span class="kql-keyword">sort</span> <span class="kql-keyword">by</span> count_ <span class="kql-keyword">desc</span>
<span class="kql-pipe">|</span> <span class="kql-function">take</span> 3</code></pre>
        </div>
    </div>

    <div class="bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 p-6 rounded-xl shadow-sm mt-12">
        <p class="font-semibold text-gray-800 text-lg">Challenge 2: Find the top 10 IP addresses with the most authentication attempts.</p>
    </div>
    <button id="solution-btn-2" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors duration-200 font-medium shadow-sm mt-4 mb-2">Show Solution</button>
    <div id="solution-div-2" class="hidden mt-4">
        <div class="code-block relative rounded-lg p-4 font-mono text-sm my-6 shadow-sm">
            <div class="flex space-x-2 absolute top-2 right-2">
                <button class="copy-btn bg-blue-100 text-blue-800 px-2 py-1 rounded-md text-xs hover:bg-blue-200 transition-colors duration-200">Copy</button>
            </div>
            <pre><code><span class="kql-table">AuthenticationEvents</span>
<span class="kql-pipe">|</span> <span class="kql-keyword">summarize</span> Attempts <span class="kql-pipe">=</span> <span class="kql-function">count()</span> <span class="kql-keyword">by</span> src_ip
<span class="kql-pipe">|</span> <span class="kql-keyword">top</span> 10 <span class="kql-keyword">by</span> Attempts <span class="kql-keyword">desc</span></code></pre>
        </div>
    </div>

    <div class="bg-gradient-to-r from-purple-50 to-violet-50 border border-purple-200 p-6 rounded-xl shadow-sm mt-12">
        <p class="font-semibold text-gray-800 text-lg">Challenge 3: Find the top 10 users with the most failed logins and show their full name and role.</p>
    </div>
    <button id="solution-btn-3" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors duration-200 font-medium shadow-sm mt-4 mb-2">Show Solution</button>
    <div id="solution-div-3" class="hidden mt-4">
        <div class="code-block relative rounded-lg p-4 font-mono text-sm my-6 shadow-sm">
            <div class="flex space-x-2 absolute top-2 right-2">
                <button class="copy-btn bg-blue-100 text-blue-800 px-2 py-1 rounded-md text-xs hover:bg-blue-200 transition-colors duration-200">Copy</button>
            </div>
            <pre><code><span class="kql-table">AuthenticationEvents</span>
<span class="kql-pipe">|</span> <span class="kql-keyword">where</span> result <span class="kql-pipe">==</span> <span class="kql-string">"Failed Login"</span>
<span class="kql-pipe">|</span> <span class="kql-keyword">summarize</span> FailedAttempts <span class="kql-pipe">=</span> <span class="kql-function">count()</span> <span class="kql-keyword">by</span> username
<span class="kql-pipe">|</span> <span class="kql-keyword">top</span> 10 <span class="kql-keyword">by</span> FailedAttempts <span class="kql-keyword">desc</span>
<span class="kql-pipe">|</span> <span class="kql-keyword">join</span> kind<span class="kql-pipe">=</span>inner (<span class="kql-table">Employees</span>) <span class="kql-keyword">on</span> username
<span class="kql-pipe">|</span> <span class="kql-keyword">project</span> name, role, FailedAttempts</code></pre>
        </div>
    </div>

    <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-lg mt-12">
        <p class="font-semibold text-gray-800">Challenge 4: Find the earliest and latest authentication event for each user.</p>
    </div>
    <button id="solution-btn-4" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors duration-200 font-medium shadow-sm mt-4 mb-2">Show Solution</button>
    <div id="solution-div-4" class="hidden mt-4">
        <div class="code-block relative rounded-lg p-4 font-mono text-sm my-6 shadow-sm">
            <div class="flex space-x-2 absolute top-2 right-2">
                <button class="copy-btn bg-blue-100 text-blue-800 px-2 py-1 rounded-md text-xs hover:bg-blue-200 transition-colors duration-200">Copy</button>
            </div>
            <pre><code><span class="kql-table">AuthenticationEvents</span>
<span class="kql-pipe">|</span> <span class="kql-keyword">summarize</span> 
    earliest_event_timestamp <span class="kql-pipe">=</span> <span class="kql-function">arg_min</span>(timestamp, timestamp), 
    latest_event_timestamp <span class="kql-pipe">=</span> <span class="kql-function">arg_max</span>(timestamp, timestamp) 
    <span class="kql-keyword">by</span> username
<span class="kql-pipe">|</span> <span class="kql-function">take</span> 10</code></pre>
        </div>
    </div>

    <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-lg mt-12">
        <p class="font-semibold text-gray-800">Challenge 5: Find all users with successful logins from China and, from that list, find which of them also have successful logins from Russia.</p>
    </div>
    <button id="solution-btn-5" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors duration-200 font-medium shadow-sm mt-4 mb-2">Show Solution</button>
    <div id="solution-div-5" class="hidden mt-4">
        <div class="code-block relative rounded-lg p-4 font-mono text-sm my-6 shadow-sm">
            <div class="flex space-x-2 absolute top-2 right-2">
                <button class="copy-btn bg-blue-100 text-blue-800 px-2 py-1 rounded-md text-xs hover:bg-blue-200 transition-colors duration-200">Copy</button>
            </div>
            <pre><code><span class="kql-keyword">let</span> C <span class="kql-pipe">=</span> <span class="kql-table">AuthenticationEvents</span>
<span class="kql-pipe">|</span> <span class="kql-keyword">where</span> <span class="kql-keyword">not</span>(<span class="kql-function">ipv4_is_private</span>(src_ip))
<span class="kql-pipe">|</span> <span class="kql-keyword">extend</span> timestamp <span class="kql-pipe">=</span> <span class="kql-function">todatetime</span>(timestamp)
<span class="kql-pipe">|</span> <span class="kql-keyword">where</span> <span class="kql-function">isnotempty</span>(src_ip)
    <span class="kql-keyword">and</span> result <span class="kql-pipe">==</span> <span class="kql-string">"Successful Login"</span>
<span class="kql-pipe">|</span> <span class="kql-keyword">extend</span> Location <span class="kql-pipe">=</span> <span class="kql-function">geo_info_from_ip_address</span>(src_ip)
<span class="kql-pipe">|</span> <span class="kql-keyword">where</span> Location <span class="kql-keyword">contains</span> <span class="kql-string">"China"</span>
<span class="kql-pipe">|</span> <span class="kql-function">distinct</span> username;
<span class="kql-table">AuthenticationEvents</span>
<span class="kql-pipe">|</span> <span class="kql-keyword">where</span> <span class="kql-keyword">not</span>(<span class="kql-function">ipv4_is_private</span>(src_ip))
<span class="kql-pipe">|</span> <span class="kql-keyword">extend</span> Location <span class="kql-pipe">=</span> <span class="kql-function">geo_info_from_ip_address</span>(src_ip)
<span class="kql-pipe">|</span> <span class="kql-keyword">where</span> username <span class="kql-keyword">in</span> (C) <span class="kql-keyword">and</span> Location <span class="kql-keyword">contains</span> <span class="kql-string">"Russia"</span>
<span class="kql-pipe">|</span> <span class="kql-function">distinct</span> username</code></pre>
        </div>
    </div>
</div>

<script>
// Solution toggle functionality
document.addEventListener('DOMContentLoaded', function() {
    // Bind solution button events
    for (let i = 1; i <= 5; i++) {
        const btn = document.getElementById(`solution-btn-${i}`);
        const div = document.getElementById(`solution-div-${i}`);
        
        if (btn && div) {
            btn.addEventListener('click', () => {
                div.classList.toggle('hidden');
                btn.textContent = div.classList.contains('hidden') ? 'Show Solution' : 'Hide Solution';
            });
        }
    }
});
</script>